	
#######################
Day 33: 29th Jan. 2026
#######################	


	AWS Cloud Platform :::
	
	==> AWS Cloud Practioner/Associate :::
	
	
	Fundamentals of Cloud Computing 
	
	AWS Cloud Computing Services 
	
	What is Cloud Computing ??
	
	Why we need Cloud Computing/Platform ??
	
	
	Use Case: Develop and Host a Web Application :::
	
		Create LMS Web Portal		==> www.loksaieta.com 
			
			- Search for course 
			- Read Course contents 
			- Enrole for Course 
			- Register for Course 
				-> Payment 
				-> SMS/EMail/Whatapps Notifications
			- Join the Classes 
			- Access the Class Materials 
			- Access the Class Records 
			
			
	I need Infra-Structure to Develop and Host this Web Application ::
	
	On-Premises Environments :
	
		- Dev 
		- Build
		- Test 
		- Prod 
		
	Highly scalable/reliable/Secured IT Infra-Structure --> Computing Devices, Storage, Networking, Security
	
	Cloud Platform :
	

	AWS Infra-Structure ::::	https://aws.amazon.com/about-aws/global-infrastructure/
		
		- AWS Region 
		
Next ::

	AWS Intro 

	Billing Management 

	IAM Services
		




#######################
Day 34: 30th Jan. 2026
#######################	

	AWS Intro :
	
		Access AWS Services :
		
			https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/
		
		AWS:
		
		Root User 	==> Administrators Account ==> Should be used only for Account Management 
		
		IAM User 	==> AWS User ==> To Create and Manage the AWS Services 

	Billing Management ::::
	
	
	Billing & Cost Management Dashboard :::
	
		

	IAM Services	:::: Global Service
	
		
		
		I A M  ==> Identity & Access Management Service.
		
		
		
		Authentication	- Define Who can Access?		
		
		Authorization	- Define what can be accessed?
		
		Role = Admin, Manager, Developer
		
		RBAC --
		
		
		IAM User :: 
			 - Create IAM User - Administrator Access
			 - With valide password
			 - Login to AWS Console as IAM User.
			 - Create AWS Resources.
			 
		
		IAM User Group
		
		IAM Policies
		
		IAM Roles 



		
	
	Working with IAM Services :
	
		- Login to AWS Console as a root user.



		

#######################
Day 35: 2nd Feb. 2026
#######################			
		
	EC2 Services ::::
		
		
	- Launch EC2 Instances :::
	
	- using User Data Option
	
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "<h1>Hello, World!</h1>" > /var/www/html/index.html

	- AMI ::: Amazon Machine Image :::
	
	
	- Create AMI based on an EC2 Instance and Use that New AMI to launch EC2 Instance
	
	- Copy AMI and Launch.
	
	
	
Access to AWS Services ::::

	- AWS Console 
	
	- AWS Cli/SDK :::
	
		- Login to AWS Console as an IAM User.
		
		- Create Access Key and Secret Key 

Next ::::

		
		- Install and Perform AWS Configuration on Local Machine.
		- Work with AWS Cli Commands 	
	
	- IAC Tools like Cloudformation / Terraform
	
	
	
#######################
Day 36: 5th Feb. 2026
#######################			
		
	EC2 Instance Storage :::

		- EBS Volumes :::
		
		- EFS Volumes :::
			
		- S3 Services ::: --> Source Codes (GIT)
		
		
		-> Volume : Used to store Files and Folders ::
		
			--> 
			
			
		Storage Administration Team ::: 
		
			Use Case : EC2,Dbase,ServerLess,Hybrid,On-prem,Kubernetes 
					 : Muliple-cloud Platform
					 
					 
		- Volume level snapshot :::
		
			Jenkins -> Upgrade ?
			
				-> jdk / jenkins plugins / Jenkins service ==> Stored in EBS 
				
			- OS Upgrade -> 
			
			
			https://uptime.is/
			
			https://aws.amazon.com/legal/service-level-agreements/
			
			https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies.html?icmpid=docs_amazons3_console
			
			
{
  "Version": "2012-10-17",
  "Statement": [
	{
	  "Sid": "Statement1",
	  "Effect": "Allow",
	  "Principal": "*",
	  "Action": [
		"s3:GetObject"
	  ],
	  "Resource": "arn:aws:s3:::pl-0205-dummybkt1/*"
	}
  ]
}			
			
			
			
			https://pl-0205-dummybkt1.s3.ap-south-1.amazonaws.com/index.html
			
			


	
#######################
Day 37: 6th Feb. 2026
#######################				
		

	Access AWS Services :::
	
	Use AWS Cli : Command line utility to access AWS Services.
	
	https://docs.aws.amazon.com/cli/v1/userguide/cli_code_examples.html
	
	
	Infra-Structure Management Team to Provision/Configure the AWS Resources ?
	
	
		- Shell Scripts: 
		
		- AWS Cli 
		
			To automate the Resource Provisioning & Configurations
		
	
		- IAC Tools : --> Based on Declarative Scripts - key:value  like json/yaml 
		
			Cloudformation / Terraform
			
		- SDK - Software Development Kit - boto3 Library
				
				
	Install and Configure AWS Cli on Local Machines 
	
		- Pre-requisites :
		
				- IAM Role to enable CLI/S3 access to EC2 Instance 
				
				- Create AWS Access Key & Secret Key ::
				
					- asdad
					
					- Qaszxczxcdas
				
				- AWS Region 
				
					- ap-south-1
					
				- apt install unzip
					
				
		- Install AWS Cli :
			
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install			
		
			
root@ip-172-31-11-27:~# aws configure

AWS Access Key ID [None]: A<>3
AWS Secret Access Key [None]: Q<>s
Default region name [None]: ap-south-1
Default output format [None]:
			
			
			
https://docs.aws.amazon.com/cli/v1/userguide/cli_s3_code_examples.html

Storage: 

AWS Database Services :::

	-> MYSQL Server/Oracle/DB2
		
		
		
Next ::::

	AWS Networking :::
	
			
			
			

	
#######################
Day 38: 9th Feb. 2026
#######################		
	
	AWS Networking :::	
	
		Computer Networking!
	
	
		IPV4 - 32 bit address 	--> x.x.x.x
		
		IPV6 - 128 bit address  --> y.y.y.y.y.y.y.y.y	==> can have globally unique address.
		
		
	
#######################
Day 39: 10th Feb. 2026
#######################		


	AWS VPC
	Subnet 
	IGW 
	IP Address
	Security Groups
	NACL 
	NAT Gateway
	
	VPC Connectivity Options :::
		
		==> 
	
	29 IP Address
	
		x.x.x.x/26 ==> 
		
		
		32 --> 


#######################
Day 39: 10th Feb. 2026
#######################			


	Demo on VPC :
		
		- Create Architecture Diagram ::
		
		
	
		- Create VPC with Public Subnet & Private Subnet 
		
		- Deploy the Applications 
		
			- 3-Tier Applications
			
		- High Availability & Load Balancing 

			- Auto-Scaling Group(ASG)
			- Elastic Application Load Balancer 
			
			
		- VPC : pl-0212-vpc						# 10.1.0.0/16
		- IGW : pl-0212-vpc-igw
		- subnet1 : pl-0212-vpc-public-sn		# 10.1.0.0/24
		- subnet1- route-table : pl-0212-vpc-public-sn-rtb 
		
		- Create EC2 Instance using this VPC  pl-0212-vpc-WebServer	
		
		
		- subnet2 : pl-0212-vpc-private-sn		# 10.1.1.0/24
		- subnet2-route-table : pl-0212-vpc-private-sn-rtb 
		
		- Create EC2 Instance using this VPC  pl-0212-vpc-AppServer
		

Next :::
		
		- High Availability & Load Balancing 

			- Auto-Scaling Group(ASG)
			- Elastic Application Load Balancer 

		- AWS Security 
	
		5 --> 
		
	
#######################
Day 40: 12th Feb. 2026
#######################			


	Demo on VPC :
		
		- Create Architecture Diagram ::
		
		
	
		- Create VPC with Public Subnet & Private Subnet 
		
		- Deploy the Applications 
		
			- 3-Tier Applications
			
		- High Availability & Load Balancing 

			- Auto-Scaling Group(ASG)
			- Elastic Application Load Balancer 
			
			
		- VPC : pl-0212-vpc						# 10.1.0.0/16
		- IGW : pl-0212-vpc-igw
		- subnet1 : pl-0212-vpc-public-sn		# 10.1.0.0/24
		- subnet1- route-table : pl-0212-vpc-public-sn-rtb 
		
		- Create EC2 Instance using this VPC  pl-0212-vpc-WebServer	
		
		
		- subnet2 : pl-0212-vpc-private-sn		# 10.1.1.0/24
		- subnet2-route-table : pl-0212-vpc-private-sn-rtb 
		
		- Create EC2 Instance using this VPC  pl-0212-vpc-AppServer
		

Next :::
		
		- High Availability & Load Balancing 

			- Auto-Scaling Group(ASG)
			- Elastic Application Load Balancer 

		- AWS Security 
	
#######################
Day 41: 13th Feb. 2026
#######################		


	- High Availability & Load Balancing 

		- Auto-Scaling Group(ASG)	==> Scalability ==> 
		
			Scaling :
			
				- Vertical Scaling 	=> 
				- Horizonal Scaling => 
		
		- Elastic Application Load Balancer 	
		
	- AWS Security :
	
		- Secret Keys
		- Key Vaults 
		
		
#######################
Day 42: 16th Feb. 2026
#######################


	- AWS Route 53 
	
	- AWS Serverless 
	
	- AWS SNS 
	
	- AWS SQS 


Next Lambda ::

	AWS Security ::
	
		- KMS 
		
		- AWS Key Vaults 
		
		- AWS Security Manager 
	
#######################
Day 43: 17th Feb. 2026
#######################


	AWS Security ::
	
		- KMS 
		
		- AWS Key Vaults 
		
		- AWS Security Manager 
		
	
		SQS --> Encryption and Decryption SSL/TLS Certificates
		
		SSH Key :
		
			Key Pair:
		
		ssh -i <path>/*.pem <username@x.x.x.x>
		
		
	AWS Cloud formation :::
	
	
		IAC Tools :::
		
			Terraform :::	AWS -> 
							Azure -> 
							
							Github repo?
							
							
		CloudFormation 			(vs)	Terraform 
		
		AWS Resource 						- Any Resource Types - AWS/Az/GCP/
		
		*.yaml/*.json						- HCL - Hashi-Corp Declarative Language (Based on json)
		
		Managed by AWS 						- Managed my Hashi Corp
		
		
		

Next :::

	Demo : 
		- Load Balancer 
		- Auto Saling Group 
		
		- Design Architecture Diagram for Project.
							
							
#######################
Day 44: 19th Feb. 2026
#######################


	AWS Cloud Watch :::
	
		- Client Server Architecture :::
		
			- AWS Cloud Watch is a fully Managed Service :
			
				--> Used to Monitor AWS Infra-Structure
				
			- AWS Cloud Watch 
			
			- AWS Cloud Trail 
			
			- AWS Config
			
	- Open Source Kubernetes --> Cli Command

		- helm ==> Package Manager for Kubernetes 
		
			- Using helm we can create dashboard and monitor Open-Source Kubernetes cluster
			
	- AI for DevOps  :
	
		- Monitor using AI :

			- Monitor Kubernetes Cluster - Helm charts to config Monitoring services .
			
		
			
Next :::

	Demo : 
	
		- Assignments :
			- VPC, Web Server, DB Server 
			- Load Balancer 
			- Auto Scaling Group 
			
		- Design Architecture Diagram for Project.
			
			
	

#######################
Day 45: 20th Feb. 2026
#######################

	Demo : 
	
		- Assignments :
			- Load Balancer 
			- Auto Scaling Group 
			

	Project :
	
		- Design Architecture Diagram for Project.
			
			- VPC, Web Server, DB Server 
			- Load Balancer 
			- Auto Scaling Group 
			- SQS
			- SNS 
			- Lambda 
			- Cloud Watch 
			- S3 			==> awscli? IAM Role 
			
			
		- Phase - 1 	:: 
		
		- Phase - 2 	:: 
		

	Demo : 
	
		- Assignments :
			- Load Balancer 
			- Auto Scaling Group 
			
	
	
	- Create EC2 Instances -- WebServer1&2 -- two diff subnets(public)
	- Setup the Security Group 				
		- plwebserver-sg1
		
	- User data - run httpd web appln.
	
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "<h1>Hello! You accessing web server - $(hostname -f)</h1>" > /var/www/html/index.html		


	- Pre-Requisites to work with Application Load Balancer ::
	
		-> Target Group --> Should include the target EC2 Instances 	WebServer-TG1
		
		-> Dedicated Load Balancer Security Group -> Internet facing!   WebServer-ALB1-SG1
		
		=> Create Application Load Balancer : 							WebServer-ALB1
		
		
		
	- Auto-Scaling Group ::::
	
		--> Create Auto-Scaling Group using the Target Group Mapping and attach to Load Balancer.
		
		--> Create Launch Template: mywebserver-asg-lt1
		
	- Resource Management :
		
		- Clean-up resources :
		
			- Delete Auto-Scaling Group 
			- Remove the Listener / Remove Load-Balancer 
			- Target Group 
	
	Project :
	
		- Design Architecture Diagram for Project.
			
			- VPC, Web Server, DB Server 
			- Load Balancer 
			- Auto Scaling Group 
			- SQS
			- SNS 
			- Lambda 
			- Cloud Watch 
			- S3 			==> awscli? IAM Role 
			
			
	- Phase 1 :
	
		Create VPC
		Create Subnets -> 2 Public Subnets, 2 Private Subnets  
		Create S3 Bucket 
		- Create IAM Role map with EC2, Lambda 
		Create RDS Database - MySql 
		- Create 
			- SQS
			- SNS 
			- Lambda 	
		
	- Phase 2 :		
			- Load Balancer 
			- Auto Scaling Group 
			

#######################
Day 46: 23rd Feb. 2026
#######################

	- Amazon Elastic Beanstalk End-to-end web application management.
	
	
	- EC2 / Lambda ==> Used to Deploy/Execute the Application/Task/Function 
	
	- Amazon Elastic Beanstalk ::
	
		- Web Application Deployments 
		
		- Web Application Migrations 
		
			- On-Prem Servers 		====>		AWS Cloud 
			
	- Use Case / Project :::
	
	Web Application :
	
	Phase 1 : Create AWS Infra-Structure with RDS
	
	Pre-Requisites ::::
	
		1. Detailed Architecture Diagram :::
		
			=> Create the Workflow :
				- Dependencies and the implementation process.
			
		2. Resource Provisioning :::
		
			=> Identify the upstream & downstream dependencies 
			
			=> Sequence of resource provisioning & Configuration
			


### Delete in this order (IMPORTANT)

1.	Auto Scaling Group
2.	Load Balancer
3.	Target Group
4.	EC2 instances
5.	RDS
6.	Lambda
7.	SQS
8.	SNS
9.	NAT Gateway (if any)
10.	Subnets
11.	Route Tables
12.	Internet Gateway
13.	VPC






________________________________________
ðŸ§  WHAT YOU WILL BUILD (READ ONCE)
VPC
â”œâ”€â”€ Public Subnet AZ1 â†’ ALB
â”œâ”€â”€ Public Subnet AZ2 â†’ ALB
â”œâ”€â”€ Private Subnet AZ1 â†’ EC2 (ASG)
â”œâ”€â”€ Private Subnet AZ2 â†’ EC2 (ASG)
â”œâ”€â”€ RDS (Private, Single AZ)
â”œâ”€â”€ SQS â†’ Lambda â†’ SNS
â””â”€â”€ CloudWatch monitoring
________________________________________
ðŸŸ¢ STEP 0: REGION SELECTION
Choose ONE region and stay there
Example:
ap-south-1 (Mumbai)
Why?
â€¢	Lower latency (India)
â€¢	Free-tier friendly
________________________________________
ðŸŸ¢ STEP 1: CREATE VPC (FOUNDATION)
Console â†’ VPC â†’ Create VPC
Parameter	Value	Why
Name	vpc-3tier-lab	Easy identification
IPv4 CIDR	10.0.0.0/16	Large private range
IPv6	No	Not needed
Tenancy	Default	Free tier
ðŸ‘‰ This gives 65,536 IPs
________________________________________
ðŸŸ¢ STEP 2: CREATE INTERNET GATEWAY
VPC â†’ Internet Gateways â†’ Create
Parameter	Value
Name	igw-3tier
Attach IGW to VPC
Actions â†’ Attach â†’ vpc-3tier-lab
Why?
â€¢	Required for public internet access
________________________________________
ðŸŸ¢ STEP 3: CREATE SUBNETS (MOST IMPORTANT STEP)
We will create 4 subnets.
________________________________________
3.1 Public Subnet â€“ AZ1
Parameter	Value
Name	public-subnet-az1
VPC	vpc-3tier-lab
AZ	ap-south-1a
CIDR	10.0.1.0/24
Why /24?
â€¢	256 IPs
â€¢	Enough for ALB + future growth
________________________________________
3.2 Public Subnet â€“ AZ2
Parameter	Value
Name	public-subnet-az2
AZ	ap-south-1b
CIDR	10.0.2.0/24
ðŸ‘‰ ALB requires minimum 2 AZs
________________________________________
3.3 Private Subnet â€“ AZ1
Parameter	Value
Name	private-subnet-az1
AZ	ap-south-1a
CIDR	10.0.3.0/24
________________________________________
3.4 Private Subnet â€“ AZ2
Parameter	Value
Name	private-subnet-az2
AZ	ap-south-1b
CIDR	10.0.4.0/24
ðŸ‘‰ EC2 ASG will span these two
________________________________________
ðŸŸ¢ STEP 4: ROUTE TABLES (VERY CRITICAL)
________________________________________
4.1 Public Route Table
Create Route Table
Name: public-rt
VPC: vpc-3tier-lab
Add Route
Destination: 0.0.0.0/0
Target: Internet Gateway
Associate Subnets
âœ” public-subnet-az1
âœ” public-subnet-az2
Why?
â€¢	Internet access for ALB
________________________________________
4.2 Private Route Table
Create Route Table
Name: private-rt
VPC: vpc-3tier-lab
No internet route (for now)
Associate Subnets
âœ” private-subnet-az1
âœ” private-subnet-az2
Why?
â€¢	EC2 protected from internet
________________________________________
ðŸŸ¢ STEP 5: SECURITY GROUPS (ZERO TRUST MODEL)
________________________________________
5.1 ALB Security Group
Rule	Value
Name	alb-sg
Inbound	HTTP 80 â†’ 0.0.0.0/0
Outbound	All
________________________________________
5.2 EC2 Security Group
Rule	Value
Name	ec2-sg
Inbound	HTTP 80 â†’ alb-sg
Inbound	SSH 22 â†’ Your IP
Outbound	All
________________________________________
5.3 RDS Security Group
Rule	Value
Name	rds-sg
Inbound	MySQL 3306 â†’ ec2-sg
Outbound	All
________________________________________
ðŸŸ¢ STEP 6: CREATE RDS (DATABASE TIER)
Create DB Subnet Group
Parameter	Value
Name	rds-subnet-group
Subnets	private-subnet-az1 + az2
________________________________________
Create RDS Instance
Parameter	Value
Engine	MySQL
Template	Free Tier
AZ	Single AZ
Instance	db.t3.micro
Storage	20 GB
Public	No
VPC	vpc-3tier-lab
SG	rds-sg
ðŸ‘‰ Save:
â€¢	Endpoint
â€¢	Username
â€¢	Password


###Create an EC2 Instance using public subnet and Login to MySQL from EC2

mysql -h <RDS-ENDPOINT> -u admin -p

Create database and table
CREATE DATABASE project1db;
USE project1db;

CREATE TABLE appusers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    filename VARCHAR(100)
);

SELECT * from appusers;

Exit MySQL:
exit

_______________________________________
ðŸŸ¢ STEP 7: CREATE SQS
Name: crud-events-queue
Type: Standard
Why?
â€¢	Async processing
â€¢	Decoupling
________________________________________
ðŸŸ¢ STEP 8: CREATE SNS
Name: crud-events-topic
Subscription: Email
âœ” Confirm email
________________________________________
ðŸŸ¢ STEP 9: CREATE LAMBDA
Parameter	Value
Runtime	Python 3.9
Role	Lambda role
Trigger	SQS
Lambda:
â€¢	Reads message
â€¢	Sends SNS email
________________________________________
ðŸŸ¢ STEP 10: CREATE TARGET GROUP
Parameter	Value
Type	Instance
Protocol	HTTP
Port	80
VPC	vpc-3tier-lab
Health	/
________________________________________
ðŸŸ¢ STEP 11: CREATE ALB (MULTI-AZ)
Parameter	Value
Type	Application LB
Scheme	Internet-facing
Subnets	Both public
SG	alb-sg
Listener	HTTP â†’ target group
________________________________________
ðŸŸ¢ STEP 12: LAUNCH TEMPLATE
Parameter	Value
AMI	Amazon Linux 2
Instance	t2.micro
SG	ec2-sg
IAM Role	EC2 role
User Data	Flask script
________________________________________
ðŸŸ¢ STEP 13: AUTO SCALING GROUP
Parameter	Value
Subnets	both private
Desired	1
Min	1
Max	3
Health	ELB
Attach	Target Group
________________________________________
ðŸŸ¢ STEP 14: FINAL TEST
1.	Open APP Server DNS/Public IP
2.	Insert record
3.	Check:
o	S# Bucket for file added
o	RDS updated
o	SQS message and trigger lambda
o	Lambda triggers email 
o	Email from SNS
________________________________________	
				


#######################
Day 47: 26th Feb. 2026
#######################


Working with AWS Project :

	3 Tier Web Application User Profile Management :
		
		VPC,Subnet,SG,RT,RTA,IAM Roles(Lambda,EC2)
		RDS - Mysql 
		S3 
		SQS -> Lambda -> SNS Notifications
		
		EC2 Instance -> Execute Web Application
		
		-> Create Web Server using Launch Template: 
		
		
		Enhancement with ASG,Load-Balancer 
		
		

1. IAM Roles

	EC2: EC2-3Tier-CRUD-Role1
	
		AmazonRDSDataFullAccess

		AmazonS3FullAccess

		AmazonSNSFullAccess

		AmazonSQSFullAccess

		AmazonSSMManagedInstanceCore

		CloudWatchAgentServerPolicy
		

	Lambda: Lambda-3Tier-CRUD-Role1
	
		AmazonSNSFullAccess

		AmazonSQSFullAccess

		AWSLambdaBasicExecutionRole

		AWSLambdaSQSQueueExecutionRole


2. Security Group	:
	
	EC2: 80,22(inbound) - Source: 0.0.0.0/0 / ALB-SG	# pl-proj1-webserver-sg1
	
	RDS: 3306(inbound) - Source: VPC:CIDR				# pl-rds-sg1
	

3. S3 Bucket	# 

	Name: loksai-edu-mlproject1 
	

4. SQS			# 

	Name: pl-proj1-db-events 
	
	url: https://sqs.ap-south-1.amazonaws.com/6asdfadaw2342a1/pl-proj1-db-events


5. Create SNS Subscription :

	Project1-topic
	
	arn:aws:sns:ap-south-1:6asdfadaw2342a1:Project1-topic


6. Lambda :


#### Lambda Code :::

Name: Project1-Lambda-Svc1

Python Code: 


import json
import boto3

sns = boto3.client('sns')

SNS_TOPIC_ARN = "arn:aws:sns:ap-south-1:6asdfadaw2342a1:Project1-topic" 

def lambda_handler(event, context):
    print("Received event:", event)

    for record in event['Records']:
        message = record['body']   # PLAIN TEXT

        print("Processing message:", message)

        response = sns.publish(
            TopicArn=SNS_TOPIC_ARN,
            Subject="LoksaiETA App Notification",
            Message=f"Event received from application:\n\n{message}"
        )

        print("SNS Publish Response:", response)

    return {
        "statusCode": 200,
        "body": "Messages processed successfully"
    }
	

7. Create Database Subnet Group 

	Name: pl-project1-db-sng1

8. RDS Database Instance(Private Subnet) 

	Name: pl-project1-rdb-instance
	
9. Create Launch Template for Web Server ::::

	--> pl-project1-webservers-lt1

#### User Data Script for Launch Template :::

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~``

#!/bin/bash
dnf update -y

# Install system packages
dnf install -y python3 pip mariadb105 unzip

# Install Python libraries
pip3 install flask pymysql boto3 werkzeug

cat <<EOF > /home/ec2-user/app.py
from flask import Flask, request, redirect, render_template_string
import pymysql
import boto3
import os
from werkzeug.utils import secure_filename

app = Flask(__name__)

# ---------------- CONFIG ----------------
DB_HOST = "pl-project1-rdb-instance.c5werwr232ad32423423ts5.ap-south-1.rds.amazonaws.com"
DB_USER = "admin"
DB_PASS = "Dummy_123"
DB_NAME = "project1db"

S3_BUCKET = "loksaiproject1"
SQS_URL = "https://sqs.ap-south-1.amazonaws.com/sdfsdwrw7551/pl-proj1-db-events"
REGION = "ap-south-1"

UPLOAD_FOLDER = "/tmp"
# ---------------------------------------

s3 = boto3.client("s3", region_name=REGION)
sqs = boto3.client("sqs", region_name=REGION)

def get_db():
    return pymysql.connect(
        host=DB_HOST,
        user=DB_USER,
        password=DB_PASS,
        database=DB_NAME
    )

# ---------------- HOME PAGE ----------------
HOME_HTML = """
<h2>Batch Profile Management</h2>

<h3>Add User</h3>
<form method="POST" action="/add" enctype="multipart/form-data">
Name: <input name="name" required>
Email: <input name="email" required>
File: <input type="file" name="file">
<button>Add</button>
</form>

<h3>User List</h3>
<table border=1>
<tr>
<th>ID</th><th>Name</th><th>Email</th><th>File</th><th>Action</th>
</tr>
{% for u in appusers %}
<tr>
<td>{{u[0]}}</td>
<td>{{u[1]}}</td>
<td>{{u[2]}}</td>
<td>{{u[3]}}</td>
<td>
<a href="/edit/{{u[0]}}">Edit</a> |
<a href="/delete/{{u[0]}}">Delete</a>
</td>
</tr>
{% endfor %}
</table>
"""

# ---------------- EDIT PAGE ----------------
EDIT_HTML = """
<h2>Edit User</h2>

<form method="POST" action="/update/{{user[0]}}">
Name: <input name="name" value="{{user[1]}}" required>
Email: <input name="email" value="{{user[2]}}" required>
<button>Update</button>
</form>

<br>
<a href="/">Back</a>
"""

@app.route("/")
def index():
    db = get_db()
    cur = db.cursor()
    cur.execute("SELECT * FROM appusers")
    appusers = cur.fetchall()
    db.close()
    return render_template_string(HOME_HTML, appusers=appusers)

# ---------------- ADD ----------------
@app.route("/add", methods=["POST"])
def add():
    name = request.form["name"]
    email = request.form["email"]
    file = request.files.get("file")
    filename = ""

    if file and file.filename:
        filename = secure_filename(file.filename)
        filepath = os.path.join(UPLOAD_FOLDER, filename)
        file.save(filepath)
        s3.upload_file(filepath, S3_BUCKET, filename)

    db = get_db()
    cur = db.cursor()
    cur.execute(
        "INSERT INTO appusers (name, email, filename) VALUES (%s, %s, %s)",
        (name, email, filename)
    )
    db.commit()
    db.close()

    # Send notification
    sqs.send_message(
        QueueUrl=SQS_URL,
        MessageBody=f"New user added: {name}, {email}"
    )

    return redirect("/")

# ---------------- EDIT ----------------
@app.route("/edit/<int:id>")
def edit(id):
    db = get_db()
    cur = db.cursor()
    cur.execute("SELECT * FROM appusers WHERE id=%s", (id,))
    user = cur.fetchone()
    db.close()
    return render_template_string(EDIT_HTML, user=user)

# ---------------- UPDATE ----------------
@app.route("/update/<int:id>", methods=["POST"])
def update(id):
    name = request.form["name"]
    email = request.form["email"]

    db = get_db()
    cur = db.cursor()
    cur.execute(
        "UPDATE appusers SET name=%s, email=%s WHERE id=%s",
        (name, email, id)
    )
    db.commit()
    db.close()

    return redirect("/")

# ---------------- DELETE ----------------
@app.route("/delete/<int:id>")
def delete(id):
    db = get_db()
    cur = db.cursor()
    cur.execute("DELETE FROM appusers WHERE id=%s", (id,))
    db.commit()
    db.close()
    return redirect("/")

# ---------------- TG Health ----------------
@app.route("/")
def health():
    return "OK", 200
	

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=80)
EOF

chown -R ec2-user:ec2-user /home/ec2-user/*

cd /home/ec2-user
sudo nohup python3 app.py > app.log 2>&1 &

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~``


10 Launch a Web Server using Launch Template(Public Subnet)  ******

	Name: PL-webappserver1


11. Login to Web Server using SSH-Key

	- Using SSH Conn

12. Login to MySQL DB Server from Web Server

	mysql -h pl-project1-rdb-instance.c5asderweww282ts5.ap-south-1.rds.amazonaws.com -P 3306 -u admin -p


13. Create Database & Table :

Create database and table
CREATE DATABASE project1db;
USE project1db;

CREATE TABLE appusers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    filename VARCHAR(100)
);

SELECT * from appusers;

Exit MySQL:
exit


14. Access the Web Server using External IP-Address
		
		
		
